---
import { t } from '../i18n/translations';
import type { Language } from '../i18n/index';
import LanguageSelector from './LanguageSelector.astro';
import { Sun, Moon, Palette } from '@lucide/astro';

interface Props {
  lang?: Language;
}

const { lang = 'en' } = Astro.props;
const translate = t(lang);

// 预先获取风格相关的翻译
const styleTranslations = {
  title: translate('style.switcher.title'),
  label: translate('style.switcher.label'),
  panelHeader: translate('style.panel.header'),
  minimal: translate('style.name.minimal'),
  editorial: translate('style.name.editorial'),
  brutalist: translate('style.name.brutalist'),
  glass: translate('style.name.glass'),
  terminal: translate('style.name.terminal'),
};
---

<header class="site-header">
  <div class="header-container">
    <div class="header-content">
      <div class="header-left">
        <a href={lang === 'en' ? '/' : `/${lang}/`} class="site-title">
          {translate('site.title')}
        </a>
        <nav class="header-nav">
          <a
            href={lang === 'en' ? '/blog' : `/${lang}/blog`}
            class="nav-link"
          >
            {translate('nav.blog')}
          </a>
        </nav>
      </div>

      <div class="header-right">
        <!-- 语言选择器 -->
        <LanguageSelector lang={lang} />

        <!-- 风格切换按钮 -->
        <div class="style-switcher">
          <button
            id="style-toggle"
            class="switcher-toggle"
            title={styleTranslations.title}
          >
            <Palette class="toggle-icon" />
            <span class="toggle-label">{styleTranslations.label}</span>
          </button>
          <div class="style-panel" id="style-panel">
            <div class="style-panel-header">{styleTranslations.panelHeader}</div>
            <div class="style-options">
              <button class="style-option active" data-style="minimal">
                <span class="style-preview minimal"></span>
                <span class="style-name">{styleTranslations.minimal}</span>
              </button>
              <button class="style-option" data-style="editorial">
                <span class="style-preview editorial"></span>
                <span class="style-name">{styleTranslations.editorial}</span>
              </button>
              <button class="style-option" data-style="brutalist">
                <span class="style-preview brutalist"></span>
                <span class="style-name">{styleTranslations.brutalist}</span>
              </button>
              <button class="style-option" data-style="glass">
                <span class="style-preview glass"></span>
                <span class="style-name">{styleTranslations.glass}</span>
              </button>
              <button class="style-option" data-style="terminal">
                <span class="style-preview terminal"></span>
                <span class="style-name">{styleTranslations.terminal}</span>
              </button>
            </div>
          </div>
        </div>

        <!-- 主题切换按钮 -->
        <!--
        <button
          id="theme-toggle"
          class="theme-toggle"
          title={translate('nav.theme.toggle')}
        >
          <Sun class="sun-icon" />
          <Moon class="moon-icon" />
        </button>
        -->
      </div>
    </div>
  </div>
</header>

<style>
  .site-header {
    background: var(--bg-primary);
    box-shadow: var(--shadow-sm);
    border-bottom: 1px solid var(--border-light);
    transition: all 0.3s ease;
  }

  .header-container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 64px;
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .site-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    text-decoration: none;
    transition: color 0.15s ease;
  }

  .site-title:hover {
    color: var(--accent);
  }

  .header-nav {
    display: none;
  }

  @media (min-width: 640px) {
    .header-nav {
      display: flex;
      align-items: center;
    }
  }

  .nav-link {
    color: var(--text-secondary);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.15s ease;
  }

  .nav-link:hover {
    color: var(--accent);
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  /* 风格切换器 */
  .style-switcher {
    position: relative;
  }

  .switcher-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border-medium);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-primary);
    cursor: pointer;
    transition: all var(--transition, 150ms ease);
  }

  .switcher-toggle:hover {
    background: var(--bg-hover);
  }

  .toggle-icon {
    width: 20px;
    height: 20px;
    color: var(--text-secondary);
  }

  .toggle-label {
    font-size: 0.875rem;
  }

  .style-panel {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    width: 14rem;
    background: var(--bg-primary);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-light);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    z-index: 50;
  }

  .style-panel.open {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .style-panel-header {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--border-light);
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .style-options {
    padding: 0.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .style-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0.75rem;
    background: transparent;
    border: none;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all var(--transition, 150ms ease);
    text-align: left;
    width: 100%;
  }

  .style-option:hover {
    background: var(--bg-hover);
  }

  .style-option.active {
    background: var(--bg-secondary);
  }

  .style-preview {
    width: 24px;
    height: 24px;
    border-radius: var(--radius-sm);
    border: 2px solid var(--border-medium);
    flex-shrink: 0;
  }

  .style-preview.minimal {
    background: linear-gradient(135deg, #0066cc 0%, #0052a3 100%);
  }

  .style-preview.editorial {
    background: linear-gradient(135deg, #8b4513 0%, #d2691e 100%);
  }

  .style-preview.brutalist {
    background: linear-gradient(135deg, #000000 0%, #ff0000 100%);
  }

  .style-preview.glass {
    background: linear-gradient(135deg, rgba(100, 200, 255, 0.3) 0%, rgba(150, 100, 255, 0.3) 100%);
  }

  .style-preview.terminal {
    background: linear-gradient(135deg, #00ff00 0%, #006400 100%);
  }

  .style-name {
    font-size: 0.875rem;
    color: var(--text-primary);
  }

  .style-option[data-style="minimal"] .style-name {
    color: #0052a3;
  }

  .style-option[data-style="editorial"] .style-name {
    color: #8b4513;
  }

  .style-option[data-style="brutalist"] .style-name {
    color: #dc2626;
  }

  .style-option[data-style="glass"] .style-name {
    color: #2563eb;
  }

  .style-option[data-style="terminal"] .style-name {
    color: #16a34a;
  }

  /* 主题切换按钮 */
  .theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: var(--radius-md);
    background: var(--bg-secondary);
    border: 1px solid var(--border-light);
    cursor: pointer;
    transition: all var(--transition, 150ms ease);
  }

  .theme-toggle:hover {
    background: var(--bg-hover);
  }

  .sun-icon,
  .moon-icon {
    width: 20px;
    height: 20px;
    color: var(--text-secondary);
  }

  .sun-icon {
    display: block;
  }

  .moon-icon {
    display: none;
  }

  :global(.dark) .sun-icon {
    display: none;
  }

  :global(.dark) .moon-icon {
    display: block;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // 主题切换
    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
      themeToggle.addEventListener('click', function() {
        if (window.toggleTheme) {
          window.toggleTheme();
        }
      });
    }

    // 风格切换器初始化
    const styleToggle = document.getElementById('style-toggle');
    const stylePanel = document.getElementById('style-panel');
    const styleOptions = document.querySelectorAll('.style-option');

    if (styleToggle && stylePanel) {
      styleToggle.addEventListener('click', function(e) {
        e.stopPropagation();
        stylePanel.classList.toggle('open');
      });

      // 点击外部关闭面板
      document.addEventListener('click', function(e) {
        if (!styleToggle.contains(e.target) && !stylePanel.contains(e.target)) {
          stylePanel.classList.remove('open');
        }
      });

      // 风格选项点击事件
      styleOptions.forEach(option => {
        option.addEventListener('click', function() {
          const newStyle = option.getAttribute('data-style');
          if (newStyle && window.switchGlobalStyle) {
            window.switchGlobalStyle(newStyle);
            styleOptions.forEach(opt => opt.classList.remove('active'));
            option.classList.add('active');
            stylePanel.classList.remove('open');
          }
        });
      });

      // 加载保存的风格
      const savedStyle = localStorage.getItem('formatter-style');
      if (savedStyle) {
        styleOptions.forEach(opt => {
          opt.classList.toggle('active', opt.getAttribute('data-style') === savedStyle);
        });
      }
    }
  });
</script> 